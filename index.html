
<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TriPeaks â€“ Offline</title>
<style>
  :root { --card-w: 86px; --card-h: 120px; }
  html, body { margin: 0; height: 100%; background: #0c5a31; color: #fff; font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
  #app { padding: env(safe-area-inset-top) 12px 12px; display: flex; flex-direction: column; align-items: center; gap: 8px; }
  .topbar { width: 100%; max-width: 920px; display: grid; grid-template-columns: 1fr auto auto auto; gap: 8px; align-items: center; }
  .title { font-weight: 800; }
  .pill { background: rgba(255,255,255,.12); border: 1px solid rgba(255,255,255,.2); padding: 6px 10px; border-radius: 999px; font-size: 14px; display: inline-flex; gap: 6px; align-items: center; }
  button { background: #ffd84d; color:#222; border:0; border-radius: 999px; padding: 8px 14px; font-weight:700; }
  .board { width: 100%; max-width: 920px; aspect-ratio: 16/10; border-radius: 16px; background: radial-gradient(1200px 600px at 30% 30%, #148a49 0, #0b4d2a 70%); position: relative; overflow: hidden; box-shadow: inset 0 0 0 1px rgba(255,255,255,.18); }
  .row { position: absolute; left: 0; right: 0; display: flex; justify-content: center; gap: 12px; }
  .row.r0 { top: 18px; } .row.r1 { top: 86px; } .row.r2 { top: 154px; } .row.r3 { top: 222px; }
  .card { width: var(--card-w); height: var(--card-h); border-radius: 10px; background: #fff; color:#111; position: relative; box-shadow: 0 6px 14px rgba(0,0,0,.35); display:flex; align-items:center; justify-content:center; font-weight:800; font-size: 26px; border:1px solid #e3e3e3; }
  .card .corner { position:absolute; left:8px; top:6px; font-size: 16px; font-weight:700; }
  .card .suit { position:absolute; right:8px; bottom:6px; font-size: 16px; }
  .red { color:#c01424; }
  .black { color:#1d1d1d; }
  .face-down { background: repeating-linear-gradient(45deg, #2b9458, #2b9458 8px, #1b6a3e 8px, #1b6a3e 16px); color: transparent; border-color: rgba(255,255,255,.25); }
  .exposed { outline: 3px solid #ffd84d; }
  .playable { cursor: pointer; transform: translateY(-2px); }
  .stack-area { position:absolute; left: 12px; right: 12px; bottom: 12px; height: 140px; display: grid; grid-template-columns: var(--card-w) var(--card-w) auto; align-items:end; gap: 12px; }
  .slot { width: var(--card-w); height: var(--card-h); border: 2px dashed rgba(255,255,255,.25); border-radius: 10px; position: relative; }
  .label { font-size: 12px; opacity:.85; margin-top: 4px; text-align:center; }
  .toast { position:absolute; inset:0; display:grid; place-items:center; pointer-events:none; }
  .toast > div { background: rgba(0,0,0,.55); padding: 12px 14px; border-radius: 10px; font-weight:800; }
  @media (max-width: 420px) {
    :root { --card-w: 74px; --card-h: 104px; }
    .row.r0 { top: 14px; } .row.r1 { top: 76px; } .row.r2 { top: 138px; } .row.r3 { top: 200px; }
    .stack-area { height: 122px; }
  }
</style>
</head>
<body>
<div id="app">
  <div class="topbar">
    <div class="title">TriPeaks â€” offline & zonder advertenties</div>
    <div class="pill">Score: <span id="score">0</span></div>
    <div class="pill">Zetten: <span id="moves">0</span></div>
    <button id="btnNew">Nieuw spel</button>
  </div>

  <div class="board" id="board">
    <div class="row r0" id="row0"></div>
    <div class="row r1" id="row1"></div>
    <div class="row r2" id="row2"></div>
    <div class="row r3" id="row3"></div>

    <div class="stack-area">
      <div>
        <div class="slot" id="stockSlot"></div>
        <div class="label">STOCK (tikken)</div>
      </div>
      <div>
        <div class="slot" id="wasteSlot"></div>
        <div class="label">AFLEG</div>
      </div>
      <div></div>
    </div>

    <div class="toast" id="toast" style="display:none;"><div id="toastText"></div></div>
  </div>

  <div class="pill">Regels: Leg kaarten weg die Ã©Ã©n hoger of lager zijn dan de bovenste afleg-kaart (A en K zijn buren). Kun je niet? Tik op de stock. Maak alles leeg om te winnen.</div>
</div>

<script>
(function() {
  "use strict";

  const $ = (id) => document.getElementById(id);
  const els = {
    board: $('board'), row0: $('row0'), row1: $('row1'), row2: $('row2'), row3: $('row3'),
    stockSlot: $('stockSlot'), wasteSlot: $('wasteSlot'),
    score: $('score'), moves: $('moves'), btnNew: $('btnNew'),
    toast: $('toast'), toastText: $('toastText')
  };

  let deck = [], stock = [], waste = [], tableau = [];
  let coveredBy = new Map();
  let score = 0, moves = 0, idCounter = 1;

  function toast(msg) {
    els.toastText.textContent = msg;
    els.toast.style.display = 'grid';
    setTimeout(()=> els.toast.style.display = 'none', 900);
  }

  function makeDeck() {
    const suits = ['â™ ','â™¥','â™¦','â™£'];
    const d = [];
    for (let s=0; s<4; s++) for (let r=1; r<=13; r++) d.push({rank:r, suit:suits[s]});
    for (let i=d.length-1;i>0;i--) { const j=Math.floor(Math.random()*(i+1)); [d[i],d[j]]=[d[j],d[i]]; }
    return d;
  }
  function rtxt(r){ return ({1:'A',11:'J',12:'Q',13:'K'}[r]||String(r)); }
  function scolor(s){ return (s==='â™¥'||s==='â™¦')?'red':'black'; }

  function cardEl(card){
    const el = document.createElement('div');
    el.className = 'card ' + (scolor(card.suit));
    el.dataset.id = card._id;
    el.innerHTML = `<div class="corner">${rtxt(card.rank)} ${card.suit}</div>${rtxt(card.rank)}<div class="suit">${card.suit}</div>`;
    return el;
  }

  function reset() {
    [els.row0,els.row1,els.row2,els.row3].forEach(r => r.innerHTML='');
    els.wasteSlot.innerHTML=''; els.stockSlot.innerHTML='';
    deck = makeDeck(); idCounter = 1; tableau = []; coveredBy.clear(); waste=[];
    score=0; moves=0; updateHUD();
  }

  function layout() {
    const counts = [3,6,9,10];
    const rowEls = [els.row0,els.row1,els.row2,els.row3];
    const idsByRow = [];
    let idx = 0;

    for (let r=0;r<4;r++){
      const ids=[];
      for (let c=0;c<counts[r];c++){
        const card = deck[idx++]; card._id = idCounter++; card._row=r;
        const el = cardEl(card);
        if (r<3) el.classList.add('face-down');
        rowEls[r].appendChild(el);
        card._el = el; tableau.push(card); ids.push(card._id);
      }
      idsByRow.push(ids);
    }

    function link(upperId, lowerId) {
      if (!coveredBy.has(lowerId)) coveredBy.set(lowerId, []);
      coveredBy.get(lowerId).push(upperId);
    }

    const starts01 = [0,2,4];
    let u=0;
    for (let p=0;p<3;p++){
      const up = idsByRow[0][u++];
      const base = starts01[p];
      link(up, idsByRow[1][base]);
      link(up, idsByRow[1][base+1]);
    }
    const starts12 = [0,3,6];
    u=0;
    for (let p=0;p<3;p++){
      const base = starts12[p];
      for (let k=0;k<2;k++){
        const up = idsByRow[1][u++];
        link(up, idsByRow[2][base+k]);
        link(up, idsByRow[2][base+k+1]);
      }
    }
    u=0;
    for (let p=0;p<3;p++){
      const base = starts12[p];
      for (let k=0;k<3;k++){
        const up = idsByRow[2][u++];
        link(up, idsByRow[3][base+k]);
        link(up, idsByRow[3][base+k+1]);
      }
    }

    idsByRow[3].forEach(id => {
      const c = tableau.find(x=>x._id===id);
      c._el.classList.remove('face-down');
    });

    stock = deck.slice(28);
    renderStockBack();
  }

  function renderStockBack() {
    els.stockSlot.innerHTML='';
    if (stock.length) {
      const back = document.createElement('div');
      back.className='card face-down';
      els.stockSlot.appendChild(back);
    }
  }

  function updateHUD(){ els.score.textContent=String(score); els.moves.textContent=String(moves); }

  function isExposed(card){
    const blockers = coveredBy.get(card._id) || [];
    return blockers.every(id => !tableau.find(c=>c._id===id));
  }

  function canPlay(card){
    if (!isExposed(card)) return false;
    if (waste.length===0) return true;
    const top = waste[waste.length-1].rank;
    const r = card.rank;
    const up = (top===13)?1:top+1;
    const down = (top===1)?13:top-1;
    return (r===up || r===down);
  }

  function refreshInteractivity(){
    tableau.forEach(c => {
      const el = c._el; if (!el) return;
      if (isExposed(c)) el.classList.add('exposed'); else el.classList.remove('exposed');
      if (canPlay(c)) el.classList.add('playable'); else el.classList.remove('playable');
    });
    renderWaste();
    renderStockBack();
  }

  function renderWaste(){
    els.wasteSlot.innerHTML='';
    if (waste.length){
      const top = waste[waste.length-1];
      els.wasteSlot.appendChild(cardEl(top));
    }
  }

  function flipStock(){
    if (!stock.length) { toast('Geen kaarten meer'); return; }
    const next = stock.pop();
    next._id = idCounter++;
    waste.push(next);
    moves++; updateHUD(); refreshInteractivity();
  }

  function removeFromTableau(card){
    if (card._el && card._el.parentElement) card._el.parentElement.removeChild(card._el);
    tableau = tableau.filter(c => c._id !== card._id);
  }

  function autoFlipFaceUps(){
    tableau.forEach(c => {
      if (c._row<3 && c._el && c._el.classList.contains('face-down') && isExposed(c)) {
        c._el.classList.remove('face-down');
      }
    });
  }

  function onCardClick(e){
    const el = e.target.closest('.card'); if (!el) return;
    const id = Number(el.dataset.id); if (!id) return;
    const card = tableau.find(c=>c._id===id); if (!card) return;
    if (!canPlay(card)) return;
    removeFromTableau(card);
    waste.push(card);
    moves++; score += 50; updateHUD();
    autoFlipFaceUps();
    refreshInteractivity();
    if (tableau.length===0){ score += 1000; updateHUD(); toast('Gewonnen! ðŸŽ‰'); }
  }

  els.board.addEventListener('click', onCardClick);
  els.stockSlot.addEventListener('click', flipStock);
  els.btnNew.addEventListener('click', () => { reset(); layout(); flipStock(); refreshInteractivity(); });

  reset(); layout(); flipStock(); refreshInteractivity();
})();
</script>
</body>
</html>
